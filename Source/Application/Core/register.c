/************************************************** Description *******************************************************/
/*
    File : register.c
    Programmer : Mohammad Lotfi
    Used : register
    Design Pattern : none
    Types of memory : Heap & Stack
    Total Tread : Nothing
    Site : https://www.mahsen.ir
    Tel : +989124662703
    Email : info@mahsen.ir
    Last Update : 2025/1/15
*/
/************************************************** Warnings **********************************************************/
/*
    Only for learning
*/
/************************************************** Wizards ***********************************************************/
/*
    Nothing
*/
/************************************************** Includes **********************************************************/
#include "register.h"
/************************************************** Defineds **********************************************************/
/*
    Nothing
*/
/************************************************** Names *************************************************************/
/*
    Nothing
*/
/************************************************** Variables *********************************************************/
/*
    Nothing
*/
/************************************************** Opjects ***********************************************************/
/*
    Nothing
*/
/************************************************** Functions *********************************************************/
u32 REGISTER_Write(u32 addr, u32 data) {
    FILE *fp;
    u32 value = 0;
    char cmd[1024];

    snprintf(cmd, sizeof(cmd), "devmem 0x%08x 32 0x%08x", addr, data);

    fp = popen(cmd, "r");

    if (fp == NULL) {
        fprintf(stderr, "%s: popen(%s) fail!\n", __func__, cmd);
        goto err;
    }

err:
    pclose(fp);
    return value;

}
/*--------------------------------------------------------------------------------------------------------------------*/
u32 REGISTER_Read(u32 addr) {
    FILE *fp;
    u32 value = 0;
    char cmd[1024];
    char buf[32];

    snprintf(cmd, sizeof(cmd), "devmem 0x%08x", addr);

    fp = popen(cmd, "r");
    if (fp == NULL) {
        fprintf(stderr, "%s: popen(%s) fail!\n", __func__, cmd);
        goto err;
    }

    fread(buf, sizeof(char), sizeof(buf), fp);
    sscanf(buf, "0x%x", &value);

err:
    pclose(fp);
    return value;
}
/************************************************** Tasks *************************************************************/
/*
    Nothing
*/
/************************************************** Vectors ***********************************************************/
/*
    Nothing
*/
/**********************************************************************************************************************/





